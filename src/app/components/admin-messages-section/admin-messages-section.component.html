<div
  class="admin-messages-header rounded-3xl border border-white/10 bg-white/5 p-6 shadow-[0_0_40px_rgba(0,0,0,0.25)] backdrop-blur-xl sm:p-8" style="margin-bottom: 25px;">
  <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <div class="flex items-center gap-3 text-sm font-semibold uppercase tracking-[0.2em] text-primary/80">
        <span class="material-symbols-outlined text-[22px]">chat_bubble</span>
        Üzenetek
      </div>
      <h1 class="mt-3 text-3xl font-black text-white sm:text-4xl" style="font-family: Newsreader;">Beérkezett üzenetek</h1>
      <p class="mt-2 max-w-2xl text-sm text-gray-300">
        A kapcsolat oldalon keresztül küldött üzenetek listája. A lekérdezés a gombnyomás után indul.
      </p>
    </div>
    <div class="admin-messages-actions flex flex-col items-start gap-2 sm:items-end">
      <button
        class="inline-flex items-center gap-2 rounded-full bg-primary px-4 py-2 text-md font-semibold text-white shadow-[0_0_18px_rgba(16,185,129,0.6)] transition hover:bg-emerald-300 disabled:cursor-not-allowed disabled:opacity-70"
        type="button"
        [disabled]="isQuerying"
        (click)="runQuery()">
        <span class="material-symbols-outlined text-[18px]">bolt</span>
        Lekérdezés
      </button>
      <button
        class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-4 py-2 text-md font-semibold text-gray-200 transition hover:border-primary/40 hover:text-white"
        type="button"
        (click)="backToOverview.emit()">
        <span class="material-symbols-outlined text-[18px]">arrow_back</span>
        Áttekintés
      </button>
    </div>
  </div>
</div>

<div class="admin-messages-card rounded-2xl border border-white/10 bg-background-dark/60 p-4 sm:p-6">
  <div class="admin-messages-controls mb-4 flex flex-wrap items-center justify-between gap-3">
    <h2 class="text-lg font-bold text-white">Üzenetek</h2>
    <div
      class="admin-messages-meta flex flex-wrap items-center gap-3 text-xs font-semibold uppercase tracking-[0.2em] text-gray-400">
      <span>Összesen: {{ messages.length }}</span>
      <label class="flex items-center gap-2">
        <span>Oldal méret</span>
        <select
          class="rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs font-semibold text-gray-200"
          [value]="pageSize"
          (change)="setPageSize($any($event.target).valueAsNumber)">
          <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
        </select>
      </label>
      <div class="flex items-center gap-2">
        <span>Oldal: {{ currentPage }} / {{ totalPages }}</span>
        <button
          class="inline-flex items-center justify-center rounded-full border border-white/10 bg-white/5 p-2 text-gray-200 transition hover:border-primary/40 hover:text-white disabled:cursor-not-allowed disabled:opacity-60"
          type="button"
          [disabled]="currentPage === 1"
          (click)="goToPage(currentPage - 1)">
          <span class="material-symbols-outlined text-[18px]">chevron_left</span>
        </button>
        <button
          class="inline-flex items-center justify-center rounded-full border border-white/10 bg-white/5 p-2 text-gray-200 transition hover:border-primary/40 hover:text-white disabled:cursor-not-allowed disabled:opacity-60"
          type="button"
          [disabled]="currentPage === totalPages"
          (click)="goToPage(currentPage + 1)">
          <span class="material-symbols-outlined text-[18px]">chevron_right</span>
        </button>
      </div>
    </div>
  </div>

  <ng-container *ngIf="messages.length > 0; else emptyState">
    <div class="admin-messages-table-wrap overflow-x-auto">
      <table class="admin-messages-table min-w-full border-separate border-spacing-y-2 text-left text-sm">
        <thead class="text-xs uppercase tracking-[0.2em] text-gray-400">
          <tr>
            <th class="px-4 py-2">Küldő</th>
            <th class="px-4 py-2">Dátum</th>
            <th class="px-4 py-2">Üzenet szövege</th>
            <th class="px-4 py-2">Státusz</th>
            <th class="px-4 py-2 text-center">Olvasás ideje</th>
            <th class="px-4 py-2 text-right">Műveletek</th>
          </tr>
        </thead>
        <tbody class="text-gray-200">
          <tr
            *ngFor="let message of pagedMessages"
            class="cursor-pointer rounded-2xl border border-white/10 bg-white/5 transition hover:border-primary/40"
            (click)="openMessage(message)">
            <td class="px-4 py-3">
              <p class="font-semibold text-white">{{ message.senderLabel }}</p>
              <p *ngIf="message.senderEmail" class="mt-1 text-xs text-gray-400">
                {{ message.senderEmail }}
              </p>
            </td>
            <td class="px-4 py-3 whitespace-nowrap">
              <p>{{ message.createdAtLabel }}</p>
            </td>
            <td class="px-4 py-3 whitespace-pre-wrap text-sm leading-relaxed">
              {{ message.preview }}
            </td>
            <td class="px-4 py-3">
              <span
                class="inline-flex rounded-full px-3 py-1 text-md font-semibold"
                [class.text-emerald-300]="message.isRead"
                [class.border-emerald-400/30]="message.isRead"
                [class.text-amber-200]="!message.isRead"
                [class.border-amber-300/40]="!message.isRead">
                {{ message.isRead ? 'Olvasott' : 'Várakozik' }}
              </span>
            </td>
            <td class="px-4 py-3 whitespace-nowrap text-sm text-center text-gray-300">
              {{ message.isRead ? message.readAtLabel : '--' }}
            </td>
            <td class="px-4 py-3 text-right">
              <div class="flex items-center justify-end gap-2">
                <button
                  class="inline-flex items-center justify-center rounded-full p-2 text-gray-200 transition hover:border-primary/40 hover:text-white disabled:cursor-not-allowed disabled:opacity-60"
                  type="button"
                  [disabled]="message.isRead"
                  title="Olvasott"
                  aria-label="Olvasott"
                  (click)="markAsRead(message, $event)">
                  <span class="material-symbols-outlined text-[16px]">done_all</span>
                </button>
                <button
                  class="inline-flex items-center justify-center rounded-full p-2 text-amber-100 transition hover:border-amber-300 hover:text-white"
                  type="button"
                  title="Archiválás"
                  aria-label="Archiválás"
                  (click)="archiveMessage(message, $event)">
                  <span class="material-symbols-outlined text-[16px]">archive</span>
                </button>
                <button
                  class="inline-flex items-center justify-center rounded-full p-2 text-rose-100 transition hover:border-rose-300 hover:text-white"
                  type="button"
                  title="Törlés"
                  aria-label="Törlés"
                  (click)="deleteMessage(message, $event)">
                  <span class="material-symbols-outlined text-[16px] text-red-400">delete</span>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="admin-messages-cards mt-4 grid gap-3">
      <div
        *ngFor="let message of pagedMessages"
        class="admin-messages-card-item cursor-pointer rounded-2xl border border-white/10 bg-white/5 p-4 transition hover:border-primary/40"
        (click)="openMessage(message)">
        <div class="flex items-start justify-between gap-3">
          <div>
            <p class="text-sm font-semibold text-white">{{ message.senderLabel }}</p>
            <p *ngIf="message.senderEmail" class="mt-1 text-xs text-gray-400">{{ message.senderEmail }}</p>
            <p class="mt-1 text-xs text-gray-400">{{ message.createdAtLabel }}</p>
            <span
              class="mt-2 inline-flex rounded-full border border-white/10 px-3 py-1 text-[11px] font-semibold"
              [class.text-emerald-300]="message.isRead"
              [class.border-emerald-400/30]="message.isRead"
              [class.text-amber-200]="!message.isRead"
              [class.border-amber-300/40]="!message.isRead">
              {{ message.isRead ? 'Olvasott' : 'Várakozik' }}
            </span>
          </div>
          <button
            class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-gray-200 transition hover:border-primary/40 hover:text-white"
            type="button"
            (click)="$event.stopPropagation(); openMessage(message)">
            <span class="material-symbols-outlined text-[16px]">open_in_new</span>
            Megnyitás
          </button>
        </div>
        <p class="mt-3 whitespace-pre-wrap text-xs text-gray-200">
          {{ message.preview }}
        </p>
        <div class="mt-4 flex flex-wrap items-center gap-2">
          <button
            class="inline-flex items-center justify-center rounded-full border border-white/10 bg-white/10 p-2 text-gray-200 transition hover:border-primary/40 hover:text-white disabled:cursor-not-allowed disabled:opacity-60"
            type="button"
            [disabled]="message.isRead"
            title="Olvasott"
            aria-label="Olvasott"
            (click)="markAsRead(message, $event)">
            <span class="material-symbols-outlined text-[16px]">done_all</span>
          </button>
          <button
            class="inline-flex items-center justify-center rounded-full border border-white/10 bg-amber-500/80 p-2 text-amber-100 transition hover:border-amber-300 hover:text-white"
            type="button"
            title="Archiválás"
            aria-label="Archiválás"
            (click)="archiveMessage(message, $event)">
            <span class="material-symbols-outlined text-[16px]">archive</span>
          </button>
          <button
            class="inline-flex items-center justify-center rounded-full border border-rose-400/40 bg-red-500 p-2 text-rose-100 transition hover:border-rose-300 hover:text-white"
            type="button"
            title="Törlés"
            aria-label="Törlés"
            (click)="deleteMessage(message, $event)">
            <span class="material-symbols-outlined text-[16px] text-red-400">delete</span>
          </button>
        </div>
      </div>
    </div>
  </ng-container>

  <ng-template #emptyState>
    <div class="rounded-2xl border border-dashed border-white/10 bg-white/5 px-6 py-10 text-center">
      <span class="material-symbols-outlined text-[32px] text-primary/80">search</span>
      <p class="mt-3 text-sm font-semibold text-white">
        {{
          hasQueried
            ? 'Nincs találat a lekérdezett üzenetek között.'
            : 'Nincs betöltött adat, indíts új lekérdezést.'
        }}
      </p>
      <p class="mt-2 text-xs text-gray-400">
        {{
          hasQueried
            ? 'Próbáld meg újra később vagy várj a cache lejáratára.'
            : 'A cache csak a Lekérdezés gombbal frissül.'
        }}
      </p>
    </div>
  </ng-template>
</div>

